C51 COMPILER V9.54   KEY                                                                   12/05/2021 16:18:12 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\key.l
                    -st) TABS(2) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "Includes.h"
   2          
   3          u8 key_driver(void)
   4          {
   5   1        static u8 key_state = key_state_0, key_time = 0;
   6   1        u8 key_press, key_return = N_key;
   7   1      
   8   1        key_press = KEY;  // ¶Á°´¼üI/OµçÆ½
   9   1      
  10   1        switch (key_state)
  11   1        {
  12   2          case key_state_0:     // °´¼ü³õÊ¼Ì¬
  13   2            if (!key_press) key_state = key_state_1;  // ¼ü±»°´ÏÂ£¬×´Ì¬×ª»»µ½°´¼üÏû¶¶ºÍÈ·ÈÏ×´Ì¬
  14   2            break;
  15   2      
  16   2          case key_state_1:     // °´¼üÏû¶¶ÓëÈ·ÈÏÌ¬
  17   2            if (!key_press)
  18   2            {
  19   3              key_time = 0;
  20   3              key_state = key_state_2;  // °´¼üÈÔÈ»´¦ÓÚ°´ÏÂ£¬Ïû¶¶Íê³É£¬×´Ì¬×ª»»µ½°´ÏÂ¼üÊ±¼äµÄ¼ÆÊ±×´Ì¬£¬µ«·µ»ØµÄ»¹ÊÇÎÞ
             -¼üÊÂ¼þ
  21   3            }
  22   2            else
  23   2              key_state = key_state_0;  // °´¼üÒÑÌ§Æð£¬×ª»»µ½°´¼ü³õÊ¼Ì¬¡£´Ë´¦Íê³ÉºÍÊµÏÖÈí¼þÏû¶¶£¬ÆäÊµ°´¼üµÄ°´ÏÂºÍÊÍ·Å
             -¶¼ÔÚ´ËÏû¶¶µÄ¡£
  24   2            break;
  25   2      
  26   2          case key_state_2:
  27   2            if(key_press)
  28   2            {
  29   3              key_return = S_key;         // ´ËÊ±°´¼üÊÍ·Å£¬ËµÃ÷ÊÇ²úÉúÒ»´Î¶Ì²Ù×÷£¬»ØËÍS_key
  30   3              key_state = key_state_0;    // ×ª»»µ½°´¼ü³õÊ¼Ì¬
  31   3            }
  32   2            else if (++key_time >= 50)    // ¼ÌÐø°´ÏÂ£¬¼ÆÊ±¼Ó10ms£¨10msÎª±¾º¯ÊýÑ­»·Ö´ÐÐ¼ä¸ô£©
  33   2            {
  34   3              key_return = L_key;         // °´ÏÂÊ±¼ä>1000ms£¬´Ë°´¼üÎª³¤°´²Ù×÷£¬·µ»Ø³¤¼üÊÂ¼þ
  35   3              key_state = key_state_3;    // ×ª»»µ½µÈ´ý°´¼üÊÍ·Å×´Ì¬
  36   3            }
  37   2            break;
  38   2      
  39   2          case key_state_3:       // µÈ´ý°´¼üÊÍ·Å×´Ì¬£¬´Ë×´Ì¬Ö»·µ»ØÎÞ°´¼üÊÂ¼þ
  40   2            if (key_press) key_state = key_state_0; //°´¼üÒÑÊÍ·Å£¬×ª»»µ½°´¼ü³õÊ¼Ì¬
  41   2            break;
  42   2        }
  43   1        return key_return;
  44   1      }
  45          
  46          /*=============
  47          ÖÐ¼ä²ã°´¼ü´¦Àíº¯Êý£¬µ÷ÓÃµÍ²ãº¯ÊýÒ»´Î£¬´¦ÀíË«»÷ÊÂ¼þµÄÅÐ¶Ï£¬·µ»ØÉÏ²ãÕýÈ·µÄÎÞ¼ü¡¢µ¥¼ü¡¢Ë«¼ü¡¢³¤¼ü4¸ö°´¼üÊÂ¼þ¡
             -£
  48          ±¾º¯ÊýÓÉÉÏ²ãÑ­»·µ÷ÓÃ£¬¼ä¸ô10ms
  49          ===============*/
  50          
  51          u8 key_read(void)
C51 COMPILER V9.54   KEY                                                                   12/05/2021 16:18:12 PAGE 2   

  52          {
  53   1        static u8 key_m = key_state_0, key_time_1 = 0;
  54   1        u8 key_return = N_key,key_temp;
  55   1      
  56   1        key_temp = key_driver();
  57   1      
  58   1        switch(key_m)
  59   1        {
  60   2          case key_state_0:
  61   2            if (key_temp == S_key )
  62   2            {
  63   3              key_time_1 = 0;               // µÚ1´Îµ¥»÷£¬²»·µ»Ø£¬µ½ÏÂ¸ö×´Ì¬ÅÐ¶ÏºóÃæÊÇ·ñ³öÏÖË«»÷
  64   3              key_m = key_state_1;
  65   3            }
  66   2            else
  67   2              key_return = key_temp;        // ¶ÔÓÚÎÞ¼ü¡¢³¤¼ü£¬·µ»ØÔ­ÊÂ¼þ
  68   2            break;
  69   2      
  70   2          case key_state_1:
  71   2            if (key_temp == S_key)             // ÓÖÒ»´Îµ¥»÷£¨¼ä¸ô¿Ï¶¨<500ms£©
  72   2            {
  73   3              key_return = D_key;           // ·µ»ØË«»÷¼üÊÂ¼þ£¬»Ø³õÊ¼×´Ì¬
  74   3              key_m = key_state_0;
  75   3            }
  76   2            else
  77   2            {                                  // ÕâÀï500msÄÚ¿Ï¶¨¶Áµ½µÄ¶¼ÊÇÎÞ¼üÊÂ¼þ£¬ÒòÎª³¤¼ü>1000ms£¬ÔÚ1sÇ°µÍ²ã·µ»
             -ØµÄ¶¼ÊÇÎÞ¼ü
  78   3              if(++key_time_1 >= 20)
  79   3              {
  80   4                key_return = S_key;      // 500msÄÚÃ»ÓÐÔÙ´Î³öÏÖµ¥¼üÊÂ¼þ£¬·µ»ØÉÏÒ»´ÎµÄµ¥¼üÊÂ¼þ
  81   4                key_m = key_state_0;     // ·µ»Ø³õÊ¼×´Ì¬
  82   4              }
  83   3            }
  84   2             break;
  85   2        }
  86   1        return key_return;
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    121    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
